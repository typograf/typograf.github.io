/*! Typograf | Â© 2015 Denis Seleznev | https://github.com/typograf/typograf/ */
!function(e,n){"function"==typeof define&&define.amd?define("typograf",[],n):"object"==typeof exports?module.exports=n():e.Typograf=n()}(this,function(){"use strict";function e(e){this._prefs="object"==typeof e?e:{},this._settings={},this._enabledRules={},this._replaceLabel=this._replaceLabel.bind(this),this._pasteLabel=this._pasteLabel.bind(this),this._initSafeTags(),this._rules.forEach(this._prepareRule,this),this._prefs.disable&&this.disable(this._prefs.disable),this._prefs.enable&&this.enable(this._prefs.enable)}return e.rule=function(n){return n.enabled=n.enabled===!1||n.disabled===!0?!1:!0,n._lang=n.name.split("/")[0],n.index=n.index||0,e.prototype._rules.push(n),e._needSortRules&&this._sortRules(),this},e.innerRule=function(n){return e.prototype._innerRules.push(n),n._lang=n.name.split("/")[0],n.index=n.index||0,e._needSortRules&&this._sortInnerRules(),this},e.data=function(n,r){if("string"==typeof n){if(1===arguments.length)return e._data[n];e._data[n]=r}else"object"==typeof n&&Object.keys(n).forEach(function(r){e._data[r]=n[r]})},e._data={},e._sortRules=function(){e.prototype._rules.sort(function(e,n){return e.index>n.index?1:-1})},e._sortInnerRules=function(){e.prototype._innerRules.sort(function(e,n){return e.index>n.index?1:-1})},e._quot=function(n,r){var a="\\d"+this.letters()+"\u0301",t=e._privateLabel,i=r.lquot,u=r.rquot,l=r.lquot2,o=r.rquot2,s="["+e.data("common/quot")+"]",c="["+a+")!?.:;#*,]*?",p=new RegExp('"([\u2026'+a+"])","gi"),d=new RegExp("("+c+')"('+c+")","gi"),h=new RegExp(s,"g"),g=new RegExp("^(s)?("+s+")","g"),m=new RegExp("(^|\\s)"+s+t,"g"),f=new RegExp(t+s+"([s!?.:;#*,]|$)","g");return n=n.replace(h,'"').replace(p,i+"$1").replace(d,"$1"+u+"$2").replace(m,"$1"+i+t).replace(f,t+u+"$1").replace(g,"$1"+i).replace(new RegExp("(^|\\w|\\s)"+u+i,"g"),"$1"+i+i),l&&o?i===l&&u===o?n.replace(new RegExp(i+i,"g"),i).replace(new RegExp(u+u,"g"),u):e._innerQuot(n,r):n},e._innerQuot=function(e,n){var r=[n.lquot],a=[n.rquot],t=n.lquot,i=n.rquot,u=new Array(e.length);n.lquot2&&n.rquot2&&(r.push(n.lquot2),a.push(n.rquot2),n.lquot3&&n.rquot3&&(r.push(n.lquot3),a.push(n.rquot3)));for(var l=-1,o=r.length-1,s=0,c=e.length;c>s;s++){var p=e[s];p===t?(l++,l>o&&(l=o),u.push(r[l])):p===i?(-1>=l&&(l=0),u.push(a[l]),l--,-1>l&&(l=-1)):u.push(p)}return u.join("")},e._langs=["en","ru"],e._privateLabel="\udbff",e.prototype={constructor:e,execute:function(e,n){n=n||{};var r=this,a=n.lang||this._prefs.lang||"common",t={},i={},u="undefined"==typeof n.mode?this._prefs.mode:n.mode,l=function(n){var r=n._lang;"common"!==r&&r!==a||!this.enabled(n.name)||(this._onBeforeRule&&this._onBeforeRule(e),e=n.handler.call(this,e,this._settings[n.name]),this._onAfterRule&&this._onAfterRule(e))},o=function(e){i[e]&&i[e].forEach(l,r),t[e]&&t[e].forEach(l,r)};return this._lang=a,(e=""+e)?(e=this._fixLineEnd(e),this._innerRules.forEach(function(e){var n=e.queue;i[n]=i[n]||[],i[n].push(e)},this),this._rules.forEach(function(e){var n=e.queue;t[n]=t[n]||[],t[n].push(e)},this),this._isHTML=-1!==e.search(/<[a-z!]/i),o("start"),this._isHTML&&(e=this._hideSafeTags(e)),e=this._utfication(e),o(),e=this._modification(e,u),this._isHTML&&(e=this._showSafeTags(e)),o("end"),this._lang=null,this._isHTML=null,e):""},setting:function(e,n,r){return arguments.length<=2?this._settings[e]&&this._settings[e][n]:(this._settings[e]=this._settings[e]||{},this._settings[e][n]=r,this)},enabled:function(e){return this._enabledRules[e]},disabled:function(e){return!this._enabledRules[e]},enable:function(e){return this._enable(e,!0)},disable:function(e){return this._enable(e,!1)},addSafeTag:function(e,n){this._safeTags.push([e,n])},letters:function(){var n=this._lang||this._prefs.lang,r=e.data("common/letter"),a=e.data(n+"/letter");return r!==a&&n?r+a:r},_fixLineEnd:function(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")},_prepareRule:function(e){var n=e.name;this._settings[n]=e.settings||{},this._enabledRules[n]=e.enabled},_enable:function(e,n){return Array.isArray(e)?e.forEach(function(e){this._enableByMask(e,n)},this):this._enableByMask(e,n),this},_enableByMask:function(e,n){var r;-1!==e.search(/\*/)?(r=new RegExp(e.replace(/\//g,"\\/").replace(/\*/g,".*")),this._rules.forEach(function(e){var a=e.name;r.test(a)&&(this._enabledRules[a]=n)},this)):this._enabledRules[e]=n},_rules:[],_innerRules:[],_initSafeTags:function(){this._safeTags=[["<!--","-->"],["<!ENTITY",">"],["<!DOCTYPE",">"],["<\\?xml","\\?>"],["<!\\[CDATA\\[","\\]\\]>"]],["code","kbd","object","pre","samp","script","style","var"].forEach(function(e){this._safeTags.push(["<"+e+"(\\s[^>]*?)?>","</"+e+">"])},this)},_hideSafeTags:function(e){return this._hiddenSafeTags={},this._iLabel=0,this._safeTags.forEach(function(n){var r=new RegExp(n[0]+"[^]*?"+n[1],"gi");e=e.replace(r,this._pasteLabel)},this),this._hideHTMLTags(e)},_getPrivateLabel:function(n){var r=e._privateLabel;return r+"tf"+n+r},_pasteLabel:function(e){var n=this._getPrivateLabel(this._iLabel);return this._hiddenSafeTags[n]=e,this._iLabel++,n},_replaceLabel:function(e){return this._hiddenSafeTags[e]},_hideHTMLTags:function(e){return e.replace(/<[a-z\/][^]*?>/gi,this._pasteLabel)},_showSafeTags:function(n){for(var r=e._privateLabel,a=new RegExp(r+"tf\\d+"+r,"g"),t=new RegExp(r+"tf\\d"),i=0;i<this._safeTags.length&&(n=n.replace(a,this._replaceLabel),-1!==n.search(t));i++);return delete this._hiddenSafeTags,n},_utfication:function(e){return-1!==e.search(/&#/)&&(e=this._decHexToUtf(e)),-1!==e.search(/&[a-z]/i)&&this.entities.forEach(function(n){e=e.replace(n[3],n[2])}),e},_decHexToUtf:function(e){return e.replace(/&#(\d{1,6});/gi,function(e,n){return String.fromCharCode(parseInt(n,10))}).replace(/&#x([\da-f]{1,6});/gi,function(e,n){return String.fromCharCode(parseInt(n,16))})},_modification:function(e,n){if("name"===n||"digit"===n){var r="name"===n?0:1;this.entities.forEach(function(n){n[r]&&(e=e.replace(n[4],n[r]))})}return e}},e.prototype.entities=[],[["nbsp",160],["iexcl",161],["cent",162],["pound",163],["curren",164],["yen",165],["brvbar",166],["sect",167],["uml",168],["copy",169],["ordf",170],["laquo",171],["not",172],["shy",173],["reg",174],["macr",175],["deg",176],["plusmn",177],["sup2",178],["sup3",179],["acute",180],["micro",181],["para",182],["middot",183],["cedil",184],["sup1",185],["ordm",186],["raquo",187],["frac14",188],["frac12",189],["frac34",190],["iquest",191],["Agrave",192],["Aacute",193],["Acirc",194],["Atilde",195],["Auml",196],["Aring",197],["AElig",198],["Ccedil",199],["Egrave",200],["Eacute",201],["Ecirc",202],["Euml",203],["Igrave",204],["Iacute",205],["Icirc",206],["Iuml",207],["ETH",208],["Ntilde",209],["Ograve",210],["Oacute",211],["Ocirc",212],["Otilde",213],["Ouml",214],["times",215],["Oslash",216],["Ugrave",217],["Uacute",218],["Ucirc",219],["Uuml",220],["Yacute",221],["THORN",222],["szlig",223],["agrave",224],["aacute",225],["acirc",226],["atilde",227],["auml",228],["aring",229],["aelig",230],["ccedil",231],["egrave",232],["eacute",233],["ecirc",234],["euml",235],["igrave",236],["iacute",237],["icirc",238],["iuml",239],["eth",240],["ntilde",241],["ograve",242],["oacute",243],["ocirc",244],["otilde",245],["ouml",246],["divide",247],["oslash",248],["ugrave",249],["uacute",250],["ucirc",251],["uuml",252],["yacute",253],["thorn",254],["yuml",255],["fnof",402],["Alpha",913],["Beta",914],["Gamma",915],["Delta",916],["Epsilon",917],["Zeta",918],["Eta",919],["Theta",920],["Iota",921],["Kappa",922],["Lambda",923],["Mu",924],["Nu",925],["Xi",926],["Omicron",927],["Pi",928],["Rho",929],["Sigma",931],["Tau",932],["Upsilon",933],["Phi",934],["Chi",935],["Psi",936],["Omega",937],["alpha",945],["beta",946],["gamma",947],["delta",948],["epsilon",949],["zeta",950],["eta",951],["theta",952],["iota",953],["kappa",954],["lambda",955],["mu",956],["nu",957],["xi",958],["omicron",959],["pi",960],["rho",961],["sigmaf",962],["sigma",963],["tau",964],["upsilon",965],["phi",966],["chi",967],["psi",968],["omega",969],["thetasym",977],["upsih",978],["piv",982],["bull",8226],["hellip",8230],["prime",8242],["Prime",8243],["oline",8254],["frasl",8260],["weierp",8472],["image",8465],["real",8476],["trade",8482],["alefsym",8501],["larr",8592],["uarr",8593],["rarr",8594],["darr",8595],["harr",8596],["crarr",8629],["lArr",8656],["uArr",8657],["rArr",8658],["dArr",8659],["hArr",8660],["forall",8704],["part",8706],["exist",8707],["empty",8709],["nabla",8711],["isin",8712],["notin",8713],["ni",8715],["prod",8719],["sum",8721],["minus",8722],["lowast",8727],["radic",8730],["prop",8733],["infin",8734],["ang",8736],["and",8743],["or",8744],["cap",8745],["cup",8746],["int",8747],["there4",8756],["sim",8764],["cong",8773],["asymp",8776],["ne",8800],["equiv",8801],["le",8804],["ge",8805],["sub",8834],["sup",8835],["nsub",8836],["sube",8838],["supe",8839],["oplus",8853],["otimes",8855],["perp",8869],["sdot",8901],["lceil",8968],["rceil",8969],["lfloor",8970],["rfloor",8971],["lang",9001],["rang",9002],["spades",9824],["clubs",9827],["hearts",9829],["diams",9830],["loz",9674],["OElig",338],["oelig",339],["Scaron",352],["scaron",353],["Yuml",376],["circ",710],["tilde",732],["ensp",8194],["emsp",8195],["thinsp",8201],["zwnj",8204],["zwj",8205],["lrm",8206],["rlm",8207],["ndash",8211],["mdash",8212],["lsquo",8216],["rsquo",8217],["sbquo",8218],["ldquo",8220],["rdquo",8221],["bdquo",8222],["dagger",8224],["Dagger",8225],["permil",8240],["lsaquo",8249],["rsaquo",8250],["euro",8364]].forEach(function(n){var r=n[0],a=n[1],t=String.fromCharCode(a),i=["&"+r+";","&#"+a+";",t,new RegExp("&"+r+";","g"),new RegExp(t,"g")];e.prototype.entities.push(i)},this),e.data("common/dash","--?|\u2012|\u2013|\u2014"),e.data("common/letter","a-z"),e.data("common/quot",'\xab\u2039\xbb\u203a\u201e\u201a\u201c\u201f\u2018\u201b\u201d\u2019"'),e.data("en/letter","a-z"),e.data({"ru/letter":"\u0430-\u044f\u0451","ru/letterUpper":"\u0410-\u042f\u0401"}),e.data({"ru/month":["\u044f\u043d\u0432\u0430\u0440\u044c","\u0444\u0435\u0432\u0440\u0430\u043b\u044c","\u043c\u0430\u0440\u0442","\u0430\u043f\u0440\u0435\u043b\u044c","\u043c\u0430\u0439","\u0438\u044e\u043d\u044c","\u0438\u044e\u043b\u044c","\u0430\u0432\u0433\u0443\u0441\u0442","\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044c","\u043e\u043a\u0442\u044f\u0431\u0440\u044c","\u043d\u043e\u044f\u0431\u0440\u044c","\u0434\u0435\u043a\u0430\u0431\u0440\u044c"],"ru/monthCase":["\u044f\u043d\u0432\u0430\u0440\u044f","\u0444\u0435\u0432\u0440\u0430\u043b\u044f","\u043c\u0430\u0440\u0442\u0430","\u0430\u043f\u0440\u0435\u043b\u044f","\u043c\u0430\u044f","\u0438\u044e\u043d\u044f","\u0438\u044e\u043b\u044f","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f","\u043e\u043a\u0442\u044f\u0431\u0440\u044f","\u043d\u043e\u044f\u0431\u0440\u044f","\u0434\u0435\u043a\u0430\u0431\u0440\u044f"],"ru/shortMonth":["\u044f\u043d\u0432","\u0444\u0435\u0432","\u043c\u0430\u0440","\u0430\u043f\u0440","\u043c\u0430[\u0435\u0439\u044f]","\u0438\u044e\u043d","\u0438\u044e\u043b","\u0430\u0432\u0433","\u0441\u0435\u043d","\u043e\u043a\u0442","\u043d\u043e\u044f","\u0434\u0435\u043a"]}),e.data("ru/weekday",["\u043f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a","\u0432\u0442\u043e\u0440\u043d\u0438\u043a","\u0441\u0440\u0435\u0434\u0430","\u0447\u0435\u0442\u0432\u0435\u0440\u0433","\u043f\u044f\u0442\u043d\u0438\u0446\u0430","\u0441\u0443\u0431\u0431\u043e\u0442\u0430","\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435"]),e.rule({name:"common/html/escape",index:110,queue:"end",handler:function(e){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return e.replace(/[&<>"'\/]/g,function(e){return n[e]})},disabled:!0}),e.rule({name:"common/html/mail",index:2e3,handler:function(e){return e.replace(/(^|[\s;(])([\w\-.]{2,})@([\w\-.]{2,})\.([a-z]{2,6})([)\s.,!?]|$)/gi,'$1<a href="mailto:$2@$3.$4">$2@$3.$4</a>$5')},disabled:!0}),e.rule({name:"common/html/nbr",index:110,queue:"start",handler:function(e){return-1===e.search(/<br/)?e.replace(/\n/g,"<br/>\n"):e},disabled:!0}),e.rule({name:"common/html/pbr",index:90,queue:"end",handler:function(e){return-1===e.search(/<(p|br)[\s\/>]/)&&(-1===e.search(/\n/)?e="<p>"+e+"</p>":(e="<p>"+e.replace(/\n\n/g,"</p>\n<p>")+"</p>",e=e.replace(/([^>])\n/g,"$1<br/>\n"))),e},disabled:!0}),e.rule({name:"common/html/stripTags",index:100,queue:"end",handler:function(e){return e.replace(/<\/?[^>]+>/g,"")},disabled:!0}),e.rule({name:"common/html/url",index:2010,handler:function(e){var n="(http|https|ftp|telnet|news|gopher|file|wais)://",r="([a-zA-Z0-9/+-=%&:_.~?]+[a-zA-Z0-9#+]*)",a=new RegExp(n+r,"g");return e.replace(a,function(e,n,r){r=r.replace(/([^\/]+\/?)(\?|#)$/,"$1").replace(/^([^\/]+)\/$/,"$1"),"http"===n?r=r.replace(/^([^\/]+)(:80)([^\d]|\/|$)/,"$1$3"):"https"===n&&(r=r.replace(/^([^\/]+)(:443)([^\d]|\/|$)/,"$1$3"));var a=r,t=n+"://"+r,i='<a href="'+t+'">';return"http"===n||"https"===n?(a=a.replace(/^www\./,""),i+("http"===n?a:n+"://"+a)+"</a>"):i+t+"</a>"})},disabled:!0}),e.rule({name:"common/nbsp/afterNumber",index:615,handler:function(e){var n="(^|\\D)(\\d{1,5}) (["+this.letters()+"]{2,})";return e.replace(new RegExp(n,"gi"),"$1$2\xa0$3")}}),e.rule({name:"common/nbsp/afterPara",index:610,handler:function(e){return e.replace(/\xa7 ?(\d|I|V|X)/g,"\xa7\xa0$1")}}),e.rule({name:"common/nbsp/afterShortWord",index:590,handler:function(e,n){var r=n.lengthShortWord,a="(^| |\xa0)(["+this.letters()+"]{1,"+r+"})(\\.?) ",t=new RegExp(a,"gi");return e.replace(t,"$1$2$3\xa0").replace(t,"$1$2$3\xa0")},settings:{lengthShortWord:2}}),e.rule({name:"common/nbsp/beforeShortLastWord",index:620,handler:function(e,n){var r=".,?!:;",a=new RegExp("([^"+r+"]) (["+this.letters()+"]{1,"+n.lengthLastWord+"}["+r+"])","gi");return e.replace(a,"$1\xa0$2")},settings:{lengthLastWord:3}}),e.rule({name:"common/nbsp/dpi",index:1150,handler:function(e){return e.replace(/(\d) ?(lpi|dpi)(?!\w)/,"$1\xa0$2")}}),function(){function n(e,n,r,a){return n+r.replace(/([^\u00A0])\u00A0([^\u00A0])/g,"$1 $2")+a}e.rule({name:"common/nbsp/nowrap",index:100,queue:"start",handler:function(e){return e.replace(/(<nowrap>)(.*?)(<\/nowrap>)/g,n).replace(/(<nobr>)(.*?)(<\/nobr>)/g,n)}})}(),e.rule({name:"common/number/fraction",index:1120,handler:function(e){return e.replace(/(^|\D)1\/2(\D|$)/g,"$1\xbd$2").replace(/(^|\D)1\/4(\D|$)/g,"$1\xbc$2").replace(/(^|\D)3\/4(\D|$)/g,"$1\xbe$2")}}),e.rule({name:"common/number/plusMinus",index:1010,handler:function(e){var n=new RegExp("(^| |\\>|\xa0)\\+-(\\d)","g");return e.replace(n,"$1\xb1$2").replace(/(^\s*)\+-(\s*$)/g,"$1\xb1$2")}}),e.rule({name:"common/number/times",index:1050,handler:function(e){return e.replace(/(\d) ?(x|\u0445) ?(\d)/g,"$1\xd7$3")}}),e.rule({name:"common/other/repeatWord",index:1200,handler:function(e){var n="(["+this.letters()+"\u0301]+) \\1([;:,.?! \n])";return e.replace(new RegExp(n,"gi"),"$1$2")},disabled:!0}),e.rule({name:"common/punctuation/delDoublePunctuation",index:580,handler:function(e){return e.replace(/(,|:|;|\?){2,}/g,"$1")}}),e.rule({name:"common/punctuation/exclamation",index:1150,handler:function(e){return e.replace(/(^|[^!])!{2}($|[^!])/,"$1!$2").replace(/(^|[^!])!{4}($|[^!])/,"$1!!!$2")}}),e.rule({name:"common/punctuation/exclamationQuestion",index:1140,handler:function(e){var n=new RegExp("(^|[^!])!\\?([^?]|$)","g");return e.replace(n,"$1?!$2")}}),e.rule({name:"common/space/afterPunctuation",index:560,handler:function(n){var r=e._privateLabel,a=new RegExp("(!|;|\\?)([^!;?\\s[)"+r+e.data("common/quot")+"])","g"),t=new RegExp("(\\D)(,|:)([^,:.?\\s\\/"+r+"])","g");return n.replace(a,"$1 $2").replace(t,"$1$2 $3")}}),e.rule({name:"common/space/delBeforePercent",index:600,handler:function(e){return e.replace(/(\d)( |\u00A0)(%|\u2030|\u2031)/g,"$1$3")}}),e.rule({name:"common/space/delBeforePunctuation",index:550,handler:function(e){return e.replace(/ (!|;|,|\?|\.|:)/g,"$1").replace(/\( /g,"(").replace(/([^ ])\(/g,"$1 (").replace(/ \)/g,")").replace(/\)([^!;,\?\.:])/g,") $1")}}),e.rule({name:"common/space/delLeadingBlanks",index:504,handler:function(e){return e.replace(/\n[ \t]+/g,"\n")},disabled:!0}),e.rule({name:"common/space/delRepeatN",index:545,handler:function(e){return e.replace(/\n{3,}/g,"\n\n")}}),e.rule({name:"common/space/delRepeatSpace",index:540,handler:function(e){return e.replace(/([^\n \t])( |\t){2,}([^\n \t])/g,"$1$2$3")}}),e.rule({name:"common/space/delTrailingBlanks",index:505,handler:function(e){return e.replace(/[ \t]+\n/g,"\n")}}),e.rule({name:"common/space/replaceTab",index:510,handler:function(e){return e.replace(/\t/g," ")}}),e.rule({name:"common/space/trimLeft",index:530,handler:String.prototype.trimLeft?function(e){return e.trimLeft()}:function(e){return e.replace(/^[\s\uFEFF\xA0]+/g,"")}}),e.rule({name:"common/space/trimRight",index:535,handler:String.prototype.trimRight?function(e){return e.trimRight()}:function(e){return e.replace(/[\s\uFEFF\xA0]+$/g,"")}}),e.rule({name:"common/sym/arrow",index:1130,handler:function(e){return e.replace(/(^|[^-])->(?!>)/g,"$1\u2192").replace(/(^|[^<])<-(?!-)/g,"$1\u2190")}}),e.rule({name:"common/sym/cf",index:1020,handler:function(e){var n=new RegExp('(\\d+)( |\xa0)?(C|F)([\\W \\.,:!\\?"\\]\\)]|$)',"g");return e.replace(n,"$1\u2009\xb0$3$4")}}),e.rule({name:"common/sym/copy",index:10,handler:function(e){return e.replace(/\(r\)/gi,"\xae").replace(/(copyright )?\((c|\u0441)\)/gi,"\xa9").replace(/\(tm\)/gi,"\u2122")}}),e.rule({name:"en/punctuation/quot",index:700,handler:e._quot,settings:{lquot:"\u201c",rquot:"\u201d",lquot2:"\u2018",rquot2:"\u2019"}}),e.data("ru/dash",{before:"(^| |\\n)",after:"( |,|\\.|\\?|:|!|$)"}),e.rule({name:"ru/dash/izpod",index:35,handler:function(n){var r=e.data("ru/dash"),a=new RegExp(r.before+"(\u0418|\u0438)\u0437 \u043f\u043e\u0434"+r.after,"g");return n.replace(a,"$1$2\u0437-\u043f\u043e\u0434$3")}}),e.rule({name:"ru/dash/izza",index:33,handler:function(n){var r=e.data("ru/dash"),a=new RegExp(r.before+"(\u0418|\u0438)\u0437 \u0437\u0430"+r.after,"g");return n.replace(a,"$1$2\u0437-\u0437\u0430$3")}}),e.rule({name:"ru/dash/kade",index:31,handler:function(n){var r=new RegExp("([a-\u044f\u0451]+)( | ?- ?)(\u043a\u0430|\u0434\u0435|\u043a\u0430\u0441\u044c)"+e.data("ru/dash").after,"g");return n.replace(r,"$1-$3$4")}}),e.rule({name:"ru/dash/koe",index:38,handler:function(n){var r=e.data("ru/dash"),a=new RegExp(r.before+"([\u041a\u043a]\u043e[\u0435\u0439])\\s([\u0430-\u044f\u0451]{3,})"+r.after,"g");return n.replace(a,"$1$2-$3$4")}}),e.rule({name:"ru/dash/main",index:620,handler:function(n){var r="ru/dash/main",a=this.setting(r,"dash"),t="("+e.data("common/dash")+")",i=e.data("ru/letter"),u=new RegExp("( |\xa0)"+t+"( |\\n)","g"),l=new RegExp("(^|"+e._privateLabel+")"+t+"( |\xa0)","gm"),o=new RegExp("(X|I|V)(?: |\xa0)?"+t+"(?: |\xa0)?(X|I|V)","g"),s=new RegExp("(["+e.data("ru/letterUpper")+"]["+i+"]+)\\s-(["+i+"]{1,3})(?![^"+i+"]|$)","g");return n.replace(u,"\xa0"+a+"$3").replace(l,"$1"+a+"\xa0").replace(o,"$1"+this.setting(r,"dashInterval")+"$3").replace(s,"$1\xa0"+a+"$2")},settings:{dash:"\u2014",dashInterval:"\u2014"}}),e.rule({name:"ru/dash/month",index:610,handler:function(n){var r="("+e.data("ru/month").join("|")+")",a=new RegExp(r+" ?("+e.data("common/dash")+") ?"+r,"gi");return n.replace(a,"$1"+this.setting("ru/dash/main","dashInterval")+"$3")}}),e.rule({name:"ru/dash/taki",index:39,handler:function(n){var r=new RegExp("(\u0432\u0435\u0440\u043d\u043e|\u0434\u043e\u0432\u043e\u043b\u044c\u043d\u043e|\u043e\u043f\u044f\u0442\u044c|\u043f\u0440\u044f\u043c\u043e|\u0442\u0430\u043a|\u0432\u0441[\u0435\u0451]|\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e|\u043d\u0435\u0443\u0436\u0435\u043b\u0438)\\s(\u0442\u0430\u043a\u0438)"+e.data("ru/dash").after,"g");return n.replace(r,"$1-$2$3")}}),e.rule({name:"ru/dash/to",index:30,handler:function(n){var r=["\u043e\u0442\u043a\u0443\u0434\u0430","\u043a\u0443\u0434\u0430","\u0433\u0434\u0435","\u043a\u043e\u0433\u0434\u0430","\u0437\u0430\u0447\u0435\u043c","\u043f\u043e\u0447\u0435\u043c\u0443","\u043a\u0430\u043a","\u043a\u0430\u043a\u043e[\u0435\u0439\u043c]","\u043a\u0430\u043a\u0430\u044f","\u043a\u0430\u043a\u0438[\u0435\u043c\u0445]","\u043a\u0430\u043a\u0438\u043c\u0438","\u043a\u0430\u043a\u0443\u044e","\u0447\u0442\u043e","\u0447\u0435\u0433\u043e","\u0447\u0435[\u0439\u043c]","\u0447\u044c\u0438\u043c?","\u043a\u0442\u043e","\u043a\u043e\u0433\u043e","\u043a\u043e\u043c\u0443","\u043a\u0435\u043c"],a=new RegExp("("+r.join("|")+")( | ?- ?)(\u0442\u043e|\u043b\u0438\u0431\u043e|\u043d\u0438\u0431\u0443\u0434\u044c)"+e.data("ru/dash").after,"gi");return n.replace(a,"$1-$3$4")}}),e.rule({name:"ru/dash/weekday",index:600,handler:function(n){var r="("+e.data("ru/weekday").join("|")+")",a=new RegExp(r+" ?("+e.data("common/dash")+") ?"+r,"gi");return n.replace(a,"$1"+this.setting("ru/dash/main","dashInterval")+"$3")}}),e.rule({name:"ru/date/main",index:1300,handler:function(e){var n="(-|\\.|\\/)",r="(-|\\/)",a=new RegExp("(^|\\D)(\\d{4})"+n+"(\\d{2})"+n+"(\\d{2})(\\D|$)","gi"),t=new RegExp("(^|\\D)(\\d{2})"+r+"(\\d{2})"+r+"(\\d{4})(\\D|$)","gi");return e.replace(a,"$1$6.$4.$2$7").replace(t,"$1$4.$2.$6$7")}}),e.rule({name:"ru/date/weekday",index:1310,handler:function(n){var r="( |\xa0)",a=e.data("ru/monthCase").join("|"),t=e.data("ru/weekday").join("|"),i=new RegExp("(\\d)"+r+"("+a+"),"+r+"("+t+")","gi");return n.replace(i,function(){var e=arguments;return e[1]+e[2]+e[3].toLowerCase()+","+e[4]+e[5].toLowerCase()})}}),e.rule({name:"ru/money/dollar",index:1140,handler:function(e){var n=new RegExp("(^|[\\D]{2,})\\$ ?([\\d.,]+)","g"),r=new RegExp("(^|[\\D])([\\d.,]+) ?\\$","g"),a="$1$2\xa0$";return e.replace(n,a).replace(r,a)}}),e.rule({name:"ru/money/euro",index:1140,handler:function(e){var n=new RegExp("(^|[\\D]{2,})\u20ac ?([\\d.]+)","g"),r=new RegExp("(^|[\\D])([\\d.,]+) ?\u20ac","g"),a="$1$2\xa0\u20ac";return e.replace(n,a).replace(r,a)}}),e.rule({name:"ru/money/ruble",index:1145,handler:function(e){var n="$1\xa0\u20bd";return e.replace(/^(\d+)( |\u00A0)?(\u0440|\u0440\u0443\u0431)\.$/,n).replace(/(\d+)( |\u00A0)?(\u0440|\u0440\u0443\u0431)\.(?=[!?,:;])/g,n).replace(/(\d+)( |\u00A0)?(\u0440|\u0440\u0443\u0431)\.(?=\s+[A-\u042f\u0401])/g,n+".")},disabled:!0}),e.rule({name:"ru/nbsp/abbr",index:565,handler:function(e){return e.replace(/(^|\s)([\u0430-\u044f\u0451]{1,3}\.){2,}(?![\u0430-\u044f\u0451])/g,function(e,n){var r=e.split(/\./);return["\u0440\u0444","\u0440\u0443","\u0440\u0443\u0441","\u043e\u0440\u0433","\u0443\u043a\u0440","\u0431\u0433","\u0441\u0440\u0431"].indexOf(r[r.length-2])>-1?e:n+e.split(/\./).join(".\xa0").trim()})}}),e.rule({name:"ru/nbsp/addr",index:1115,handler:function(e){return e.replace(/(\s|^)(\u0434\u043e\u043c|\u0434\.|\u043a\u0432\.|\u043f\u043e\u0434\.|\u043f\-\u0434) *(\d+)/gi,"$1$2\xa0$3").replace(/(\s|^)(\u043c\u043a\u0440-\u043d|\u043c\u043a-\u043d|\u043c\u043a\u0440\.|\u043c\u043a\u0440\u043d)\s/gi,"$1$2\xa0").replace(/(\s|^)(\u044d\u0442\.) *(-?\d+)/gi,"$1$2\xa0$3").replace(/(\s|^)(\d+) +\u044d\u0442\u0430\u0436([^\u0430-\u044f\u0451]|$)/gi,"$1$2\xa0\u044d\u0442\u0430\u0436$3").replace(/(\s|^)\u043b\u0438\u0442\u0435\u0440\s([\u0410-\u042f]|$)/gi,"$1\u043b\u0438\u0442\u0435\u0440\xa0$2").replace(/(\s|^)(\u043e\u0431\u043b|\u043a\u0440|\u0433|\u0441\u0442|\u043f\u043e\u0441|\u0441|\u0434|\u0443\u043b|\u043f\u0435\u0440|\u043f\u0440|\u043f\u0440\-\u0442|\u043f\u0440\u043e\u0441\u043f|\u043f\u043b|\u0431\u0443\u043b|\u0431\-\u0440|\u043d\u0430\u0431|\u0448|\u0442\u0443\u043f|\u043e\u0444|\u043a\u043e\u043c\u043d?|\u0443\u0447|\u0432\u043b|\u0432\u043b\u0430\u0434|\u0441\u0442\u0440|\u043a\u043e\u0440)\. *([\u0430-\u044f\u0451a-z\d]+)/gi,"$1$2.\xa0$3")}}),e.rule({name:"ru/nbsp/afterNumberSign",index:610,handler:function(e){return e.replace(/\u2116 ?(\d|\u043f\/\u043f)/g,"\u2116\xa0$1")}}),e.rule({name:"ru/nbsp/beforeParticle",index:570,handler:function(e){return e.replace(/ (\u043b\u0438|\u043b\u044c|\u0436\u0435|\u0436|\u0431\u044b|\u0431)([^\u0430-\u044f\u0451\u0410-\u042f\u0401])/g,"\xa0$1$2")}}),e.rule({name:"ru/nbsp/but",index:1110,handler:function(e){var n=new RegExp(",?( |\xa0|\n)(\u0430|\u043d\u043e)( |\xa0|\n)","g");return e.replace(n,",$1$2$3")}}),e.rule({name:"ru/nbsp/cc",index:1090,handler:function(e){return e=e.replace(/(^|\d|V|I|X) ?\u0432(\u0432)?( |,|;|\n|$)/g,"$1\xa0\u0432$2.$3"),e.replace(/(^|\d|[IVX]) ?\u0432\.? ?\u0432\./g,"$1\xa0\u0432\u0432.")}}),e.rule({name:"ru/nbsp/dayMonth",index:1105,handler:function(n){var r=new RegExp("(\\d{1,2}) ("+e.data("ru/shortMonth").join("|")+")","gi");return n.replace(r,"$1\xa0$2")}}),e.rule({name:"ru/nbsp/m",index:1030,handler:function(e){var n="(\u043a\u043c|\u043c|\u0434\u043c|\u0441\u043c|\u043c\u043c)",r=new RegExp("(^|\\D)(\\d+) ?"+n+"2(\\D|$)","g"),a=new RegExp("(^|\\D)(\\d+) ?"+n+"3(\\D|$)","g");return e.replace(r,"$1$2\xa0$3\xb2$4").replace(a,"$1$2\xa0$3\xb3$4")}}),e.rule({name:"ru/nbsp/ooo",index:1100,handler:function(e){return e.replace(/(^|[^a-\u044f\u0451A-\u042f\u0401])(\u041e\u041e\u041e|\u041e\u0410\u041e|\u0417\u0410\u041e|\u041d\u0418\u0418|\u041f\u0411\u041e\u042e\u041b) /g,"$1$2\xa0")}}),e.rule({name:"ru/nbsp/page",index:610,handler:function(e){return e.replace(/ (\u0441\u0442\u0440|\u0433\u043b|\u0440\u0438\u0441|\u0438\u043b\u043b)\./g,"\xa0$1.")}}),e.rule({name:"ru/nbsp/xxxx",index:1060,handler:function(e){return e.replace(/(^|\D)(\d{1,4}) ?\u0433(\u043e\u0434| |,|;|\.|\n|$)/g,"$1$2\xa0\u0433$3")}}),e.rule({name:"ru/nbsp/yy",index:1080,handler:function(e){return e.replace(/(^|\d) ?\u0433\. ?\u0433\./g,"$1\xa0\u0433\u0433.")}}),e.rule({name:"ru/number/ordinals",index:1300,handler:function(e){return e.replace(/(\d)-(\u044b\u0439|\u043e\u0439)([^\u0430-\u044f\u0451]|$)/g,"$1-\u0439$3").replace(/(\d)-\u0430\u044f([^\u0430-\u044f\u0451]|$)/g,"$1-\u044f$2").replace(/(\d)-(\u043e\u0435|\u044b\u0435)([^\u0430-\u044f\u0451]|$)/g,"$1-\u0435$3").replace(/(\d)-(\u044b\u043c|\u043e\u043c)([^\u0430-\u044f\u0451]|$)/g,"$1-\u043c$3").replace(/(\d)-\u044b\u0445([^\u0430-\u044f\u0451]|$)/g,"$1-\u0445$2").replace(/(\d)-\u043e\u0433\u043e([^\u0430-\u044f\u0451]|$)/g,"$1-\u0433\u043e$2").replace(/(\d)-\u043e\u043c\u0443([^\u0430-\u044f\u0451]|$)/g,"$1-\u043c\u0443$2").replace(/(\d)-\u044b\u043c\u0438([^\u0430-\u044f\u0451]|$)/g,"$1-\u043c\u0438$2")}}),e.rule({name:"ru/optalign/bracket",index:1001,handler:function(e,n){return e.replace(/( |\u00A0)\(/g,'<span class="typograf-oa-sp-lbracket">$1</span><span class="typograf-oa-lbracket">(</span>').replace(/(^|\n)\(/g,'$1<span class="typograf-oa-n-lbracket">(</span>')},disabled:!0}).innerRule({name:"ru/optalign/bracket",handler:function(e){return e.replace(/<span class="typograf-oa-(sp-lbracket|lbracket|n-lbracket)">(.*?)<\/span>/g,"$2")}}),e.rule({name:"ru/optalign/comma",index:1002,handler:function(e,n){var r=new RegExp("(["+this.letters()+"\\d\u0301]+), ","gi");return e.replace(r,'$1<span class="typograf-oa-comma">,</span><span class="typograf-oa-comma-sp"> </span>')},disabled:!0}).innerRule({name:"ru/optalign/comma",handler:function(e){return e.replace(/<span class="typograf-oa-(comma|comma-sp)">(.*?)<\/span>/g,"$2")}}),e.rule({name:"ru/optalign/quot",index:1e3,handler:function(n){var r='(["'+this.setting("ru/punctuation/quot","lquot")+this.setting("ru/punctuation/quot","lquot2")+"])",a=new RegExp("([\\d"+this.letters()+"\\-\u0301!?.:;,]+)( |\xa0)("+r+")","gi"),t=new RegExp("(^|\n|"+e._privateLabel+")"+r,"g");return n.replace(a,'$1<span class="typograf-oa-sp-lquot">$2</span><span class="typograf-oa-lquot">$3</span>').replace(t,'$1<span class="typograf-oa-n-lquot">$2</span>')},disabled:!0}).innerRule({name:"ru/optalign/quot",handler:function(e){return e.replace(/<span class="typograf-oa-(sp-lquot|lquot|n-lquot)">(.*?)<\/span>/g,"$2")}}),e.rule({name:"ru/other/accent",index:560,handler:function(e){return e.replace(/([\u0430-\u044f\u0451])([\u0410\u0415\u0401\u0418\u041e\u0423\u042b\u042d\u042e\u042f])([^\u0410-\u042f\u0401\w]|$)/g,function(e,n,r,a){return n+r.toLowerCase()+"\u0301"+a})},disabled:!0}),e.rule({name:"ru/punctuation/hellip",index:20,handler:function(e){return e.replace(/(^|[^.])\.{3,4}([^.]|$)/g,"$1\u2026$2").replace(/(^|[^.])(\.\.\.|\u2026),/g,"$1\u2026").replace(/(\!|\?)(\.\.\.|\u2026)([^.]|$)/g,"$1..$3")}}),e.rule({name:"ru/punctuation/quot",index:700,handler:e._quot,settings:{lquot:"\xab",rquot:"\xbb",lquot2:"\u201e",rquot2:"\u201c",lquot3:"\u201a",rquot3:"\u2018"}}),e._sortRules(),e._needSortRules=!0,e});